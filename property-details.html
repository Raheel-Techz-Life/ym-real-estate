<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Details | Y M REAL ESTATE</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    /* NAVY THEME */
    :root { --primary: #263f6e; --accent: #ffd700; --bg: linear-gradient(135deg, #f6faff 0%, #e8f0fe 100%); }
    body { margin:0; font-family:'Segoe UI', sans-serif; background:var(--bg); padding-bottom:40px; }

    /* HEADER STYLES (Matches Login/Admin) */
    .header { 
        background: #263f6e; /* Your Primary Blue */
        color: #fff; 
        padding: 15px 40px; /* Bigger padding = Bigger bar */
        display: flex; 
        justify-content: space-between; 
        align-items: center;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
        position: sticky; 
        top: 0; 
        z-index: 1000; 
    }

    .logo-area { 
        display: flex;
        align-items: center;
        gap: 15px;
        text-decoration: none; 
        color: white; 
        font-weight: bold; 
        font-size: 1.4rem; /* Larger Text */
    }

    .logo-img {
        height: 45px; /* Adjust size of logo image */
        width: auto;
        border-radius: 5px;
    }

    .nav-links a {
        color: rgba(255,255,255,0.9);
        text-decoration: none;
        margin-left: 25px;
        font-weight: 500;
        font-size: 1rem;
        transition: color 0.3s;
    }

    .nav-links a:hover { color: #ffd700; } /* Gold hover effect */
    
    .container { max-width:1100px; margin:30px auto; padding:0 20px; }
    
    /* SLIDER */
    .slider { position:relative; height:450px; background:#ddd; border-radius:15px; overflow:hidden; margin-bottom:30px; box-shadow:0 10px 30px rgba(0,0,0,0.1); }
    .slide-track { display:flex; height:100%; transition:transform 0.4s; }
    .slide { min-width:100%; height:100%; }
    .slide img { width:100%; height:100%; object-fit:cover; }
    .arrow { position:absolute; top:50%; transform:translateY(-50%); background:rgba(255,255,255,0.8); border:none; width:40px; height:40px; border-radius:50%; cursor:pointer; font-size:20px; color:var(--primary); }
    .prev { left:20px; } .next { right:20px; }
    .badge { position:absolute; bottom:20px; right:20px; background:rgba(38,63,110,0.8); color:white; padding:5px 15px; border-radius:20px; }

    /* INFO */
    .grid { display:grid; grid-template-columns:2fr 1fr; gap:30px; }
    .card { background:white; padding:30px; border-radius:15px; box-shadow:0 5px 20px rgba(0,0,0,0.05); }
    
    .title { color:var(--primary); margin:0; font-size:2rem; }
    .price { color:var(--accent); font-size:1.8rem; font-weight:bold; text-shadow:1px 1px 1px rgba(0,0,0,0.1); }
    .loc { color:#666; margin-bottom:20px; }
    
    .feats { display:flex; gap:20px; margin:20px 0; padding:20px 0; border-top:1px solid #eee; border-bottom:1px solid #eee; }
    .feat { display:flex; align-items:center; gap:8px; font-weight:600; color:var(--primary); }
    
    .agent-box { text-align:center; background:var(--primary); color:white; padding:30px; border-radius:15px; position:sticky; top:20px; }
    .agent-img { width:100px; height:100px; border-radius:50%; background:white; object-fit:cover; border:3px solid rgba(255,255,255,0.3); margin-bottom:15px; }
    .btn { display:block; padding:12px; margin-top:10px; border-radius:8px; text-decoration:none; font-weight:bold; }
    .btn-wa { background:#25D366; color:white; }

    @media(max-width:800px) { .grid{grid-template-columns:1fr;} .slider{height:300px;} }
  </style>
</head>
<body>

<div class="header">
    <a href="index.html" class="logo-area">
        <img src="ymr.jpg" alt="YM Logo" class="logo-img" onerror="this.style.display='none'"> 
        <span>YM REAL ESTATE</span>
    </a>

    <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="properties.html">Properties</a>
        <a href="contact.html">Contact</a>
        <a href="login.html" style="background:rgba(255,255,255,0.2); padding:8px 15px; border-radius:5px;">Login</a>
    </div>
</div>

<div class="container">
    <div class="slider" id="slider">
        <div class="slide-track" id="track"></div>
        <button class="arrow prev" onclick="move(-1)">&#10094;</button>
        <button class="arrow next" onclick="move(1)">&#10095;</button>
        <div class="badge" id="counter">1/1</div>
    </div>

    <div class="grid">
        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                <div>
                    <span style="background:var(--primary); color:white; padding:4px 10px; border-radius:20px; font-size:0.8rem;" id="type">Type</span>
                    <h1 class="title" id="title">Loading...</h1>
                    <div class="loc" id="city">Location</div>
                </div>
                <div class="price" id="price">...</div>
            </div>

            <div class="feats">
                <div class="feat"><i class="fas fa-ruler"></i> <span id="area">0</span> sqft</div>
                <div class="feat"><i class="fas fa-bed"></i> <span id="beds">0</span> Bed</div>
                <div class="feat"><i class="fas fa-bath"></i> <span id="baths">0</span> Bath</div>
            </div>

            <h3>Description</h3>
            <p id="desc" style="line-height:1.6; color:#555;">...</p>
            
            <h3>Amenities</h3>
            <div id="amenities" style="display:flex; gap:10px; flex-wrap:wrap;"></div>
        </div>

        <div class="agent-box">
            <img src="https://placehold.co/100" class="agent-img" id="aImg">
            <h3 id="aName">Agent</h3>
            <p>Property Consultant</p>
            <a href="#" class="btn btn-wa" id="btnWa">WhatsApp</a>
            <a href="#" class="btn" style="background:white; color:var(--primary);" id="btnCall">Call Now</a>
        </div>
    </div>
</div>

<script>
    const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    const API = isLocal ? 'http://localhost:5011' : 'https://ym-real-estate.onrender.com';

    // --- DIRECT UPLOAD IMAGE FIXER ---
    function getImgUrl(path) {
        if (!path) return 'https://placehold.co/1200x600?text=No+Image';
        if (path.startsWith('http')) return path;
        
        // This splits by slash or backslash and takes the last part (the filename)
        // e.g., "C:\Users\Downloads\house.jpg" -> "house.jpg"
        const filename = path.split(/[/\\]/).pop();
        return `${API}/uploads/${filename}`;
    }

    let curr = 0; let total = 0;

    window.onload = async () => {
        const id = new URLSearchParams(window.location.search).get('id');
        if(!id) return document.body.innerHTML = "<h1 style='text-align:center; margin-top:50px'>Property Not Found</h1>";

        const res = await fetch(`${API}/api/properties/${id}`);
        const d = await res.json();
        const p = d.data || d;

        document.getElementById('title').innerText = p.title;
        document.getElementById('price').innerText = "â‚¹ " + Number(p.price).toLocaleString();
        document.getElementById('city').innerText = p.address?.city || 'India';
        document.getElementById('type').innerText = p.propertyType;
        document.getElementById('desc').innerText = p.description || 'No description provided.';
        
        document.getElementById('area').innerText = p.features?.area || 0;
        document.getElementById('beds').innerText = p.features?.bedrooms || 0;
        document.getElementById('baths').innerText = p.features?.bathrooms || 0;

        const am = p.amenities ? (Array.isArray(p.amenities) ? p.amenities : p.amenities.split(',')) : [];
        document.getElementById('amenities').innerHTML = am.map(a => `<span style="background:#f0f4ff; border:1px solid #dbeafe; color:#1e40af; padding:5px 12px; border-radius:20px; font-size:0.9rem;">${a}</span>`).join('');

        if(p.owner) {
            document.getElementById('aName').innerText = p.owner.name;
            document.getElementById('aImg').src = `https://placehold.co/100/263f6e/FFF?text=${p.owner.name[0]}`;
            document.getElementById('btnCall').href = `tel:${p.owner.phone}`;
            document.getElementById('btnWa').href = `https://wa.me/${p.owner.phone.replace(/\D/g,'')}?text=Hi, interested in ${p.title}`;
        }

        setupSlider(p.images);
    };

    function setupSlider(imgs) {
        const t = document.getElementById('track');
        if(!imgs || !imgs.length) { t.innerHTML = `<div class="slide"><img src="https://placehold.co/800x400?text=No+Image"></div>`; return; }
        
        total = imgs.length;
        t.innerHTML = imgs.map(url => `<div class="slide"><img src="${getImgUrl(url)}"></div>`).join('');
        updateUI();
    }

    function move(d) {
        if(total < 2) return;
        curr += d;
        if(curr >= total) curr = 0;
        if(curr < 0) curr = total - 1;
        document.getElementById('track').style.transform = `translateX(-${curr * 100}%)`;
        updateUI();
    }
    
    function updateUI() {
        document.getElementById('counter').innerText = `${curr+1}/${total}`;
    }
    
    // Swipe support
    let ts = 0;
    const s = document.getElementById('slider');
    s.addEventListener('touchstart', e => ts = e.touches[0].clientX);
    s.addEventListener('touchend', e => {
        const te = e.changedTouches[0].clientX;
        if(ts - te > 50) move(1);
        if(te - ts > 50) move(-1);
    });
</script>
</body>
</html>
