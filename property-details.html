<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Property Details | Y M REAL ESTATE</title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <style>
    /* --- THEME MATCHING LOGIN --- */
    :root { 
        --primary: #263f6e;
        --primary-dark: #18284b;
        --accent: #ffd700;
        --text: #2d3748;
        --bg-gradient: linear-gradient(135deg, #f6faff 0%, #e8f0fe 100%);
        --shadow: 0 10px 40px rgba(38,63,110,0.12);
        --card-bg: #ffffff;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Arial, sans-serif; }
    body { background: var(--bg-gradient); color: var(--text); min-height: 100vh; padding-bottom: 40px; }

    /* --- HEADER --- */
    .header {
      background: var(--primary);
      color: #fff;
      padding: 15px 40px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky; top: 0; z-index: 1000;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .logo-area { display: flex; align-items: center; gap: 12px; text-decoration: none; color: white; }
    .logo-img { width: 45px; height: 45px; border-radius: 10px; background: #fff; padding: 2px; }
    
    .nav { display: flex; gap: 20px; }
    .nav a { 
        padding: 8px 16px; border-radius: 6px; transition: 0.2s; font-size: 0.95rem; 
        text-decoration: none; color: white; 
    }
    .nav a:hover { background: var(--primary-dark); }

    /* --- LAYOUT --- */
    .container { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
    .breadcrumb { margin-bottom: 20px; font-size: 0.9rem; color: #666; }
    .breadcrumb a { color: var(--primary); font-weight: 600; text-decoration: none; }

    /* --- CAROUSEL --- */
    .carousel-wrapper {
        position: relative; width: 100%; height: 500px;
        border-radius: 16px; overflow: hidden; margin-bottom: 30px;
        background: #ddd; box-shadow: var(--shadow);
    }
    .carousel-track { display: flex; height: 100%; transition: transform 0.4s ease-out; }
    .carousel-slide { min-width: 100%; height: 100%; }
    .carousel-slide img { width: 100%; height: 100%; object-fit: cover; }
    
    .nav-btn {
        position: absolute; top: 50%; transform: translateY(-50%);
        background: rgba(255,255,255,0.9); color: var(--primary); border: none;
        width: 45px; height: 45px; border-radius: 50%; cursor: pointer;
        display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
        z-index: 10; transition: 0.2s;
    }
    .nav-btn:hover { background: var(--primary); color: white; }
    .prev { left: 20px; } .next { right: 20px; }
    .badge-count {
        position: absolute; bottom: 20px; right: 20px;
        background: rgba(38,63,110,0.8); color: white;
        padding: 5px 15px; border-radius: 20px; font-size: 0.9rem;
    }

    /* --- INFO GRID --- */
    .grid { display: grid; grid-template-columns: 2fr 1fr; gap: 30px; }
    
    .prop-card {
        background: var(--card-bg); border-radius: 16px; padding: 30px;
        box-shadow: var(--shadow); margin-bottom: 25px; border: 1px solid #fff;
    }

    .title { font-size: 2rem; color: var(--primary); font-weight: 700; line-height: 1.2; margin-bottom: 10px; }
    .price { font-size: 1.8rem; color: var(--accent); font-weight: 700; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
    .location { color: #666; font-size: 1.1rem; margin-bottom: 20px; display: flex; align-items: center; gap: 8px; }

    .features { display: flex; gap: 20px; flex-wrap: wrap; margin: 20px 0; padding: 20px 0; border-top: 1px solid #eee; border-bottom: 1px solid #eee; }
    .feat-item { display: flex; align-items: center; gap: 8px; font-weight: 600; color: var(--primary); }
    .feat-item i { color: var(--accent); font-size: 1.2rem; }

    .tag-container { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
    .tag {
        background: #f6faff; border: 1px solid #e0e7ff; color: var(--primary);
        padding: 8px 16px; border-radius: 50px; font-size: 0.9rem; font-weight: 500;
        display: flex; align-items: center; gap: 8px;
    }

    /* AGENT CARD */
    .agent-box {
        position: sticky; top: 100px;
        background: var(--primary); color: white;
        text-align: center; padding: 35px 25px; border-radius: 16px;
        box-shadow: 0 10px 30px rgba(38,63,110,0.3);
    }
    .agent-img {
        width: 100px; height: 100px; border-radius: 50%;
        border: 4px solid rgba(255,255,255,0.2); object-fit: cover;
        background: white; margin-bottom: 15px;
    }
    .agent-btn {
        display: block; width: 100%; padding: 12px; margin-top: 12px;
        border-radius: 10px; text-decoration: none; font-weight: 600;
        transition: 0.2s;
    }
    .btn-call { background: white; color: var(--primary); }
    .btn-wa { background: #25D366; color: white; }

    @media (max-width: 900px) {
        .header { flex-direction: column; gap: 15px; padding: 15px; }
        .nav { width: 100%; justify-content: center; }
        .grid { grid-template-columns: 1fr; }
        .carousel-wrapper { height: 300px; }
    }
  </style>
</head>
<body>

<div class="header">
    <a href="index.html" class="logo-area">
        <img src="ym.jpg" alt="Logo" class="logo-img" onerror="this.src='https://placehold.co/50'">
        <span style="font-size: 1.3em; font-weight: bold;">Y M REAL ESTATE</span>
    </a>
    <div class="nav">
        <a href="index.html">Home</a>
        <a href="properties.html">Properties</a>
        <a href="contact.html">Contact</a>
    </div>
</div>

<div class="container">
    <div class="breadcrumb">
        <a href="index.html">Home</a> / <a href="properties.html">Properties</a> / <span id="breadTitle">...</span>
    </div>

    <div class="carousel-wrapper" id="carousel">
        <div class="carousel-track" id="track"></div>
        <button class="nav-btn prev" onclick="moveSlide(-1)">&#10094;</button>
        <button class="nav-btn next" onclick="moveSlide(1)">&#10095;</button>
        <div class="badge-count" id="imgCount">1/1</div>
    </div>

    <div class="grid">
        <div>
            <div class="prop-card">
                <div style="display:flex; justify-content:space-between; flex-wrap:wrap; align-items:flex-start;">
                    <div>
                        <div style="margin-bottom:10px;">
                            <span class="tag" style="display:inline-flex; background:var(--primary); color:white; border:none;" id="typeTag">House</span>
                        </div>
                        <h1 class="title" id="dispTitle">Loading...</h1>
                        <div class="location"><i class="fas fa-map-marker-alt" style="color:#ef4444"></i> <span id="dispCity">Location</span></div>
                    </div>
                    <div class="price" id="dispPrice">₹...</div>
                </div>

                <div class="features">
                    <div class="feat-item"><i class="fas fa-ruler-combined"></i> <span id="fArea">-</span> sqft</div>
                    <div class="feat-item"><i class="fas fa-bed"></i> <span id="fBeds">-</span> Bed</div>
                    <div class="feat-item"><i class="fas fa-bath"></i> <span id="fBaths">-</span> Bath</div>
                    <div class="feat-item"><i class="fas fa-car"></i> <span id="fPark">No</span> Parking</div>
                </div>

                <h3 style="color:var(--primary); margin-bottom:15px;">Description</h3>
                <p id="dispDesc" style="line-height:1.6; color:#555;">No description available.</p>
            </div>

            <div class="prop-card">
                <h3 style="color:var(--primary); margin-bottom:15px;">Amenities</h3>
                <div class="tag-container" id="amContainer"></div>
            </div>
        </div>

        <div>
            <div class="agent-box">
                <img src="https://placehold.co/150" class="agent-img" id="agentImg">
                <h3 id="agentName" style="margin-bottom:5px;">Agent Name</h3>
                <p style="opacity:0.8; margin-bottom:20px;">Property Consultant</p>
                <a href="#" class="agent-btn btn-call" id="btnCall"><i class="fas fa-phone"></i> Call Now</a>
                <a href="#" class="agent-btn btn-wa" id="btnWa"><i class="fab fa-whatsapp"></i> WhatsApp</a>
            </div>
        </div>
    </div>
</div>

<script>
    // --- 1. CONNECT TO BACKEND ---
    const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    const API_BASE = isLocal ? 'http://localhost:5011' : 'https://ym-real-estate.onrender.com';

    // --- 2. IMAGE FIX FUNCTION ---
    function getImageUrl(path) {
        if (!path) return 'https://placehold.co/1200x600?text=No+Image';
        if (path.startsWith('http')) return path; 
        const cleanPath = path.replace(/\\/g, '/').replace('uploads/', '');
        return `${API_BASE}/uploads/${cleanPath}`;
    }

    let currentSlide = 0; let totalSlides = 0;

    window.onload = async () => {
        const id = new URLSearchParams(window.location.search).get('id');
        if(!id) return document.body.innerHTML = '<h1 style="text-align:center; margin-top:50px; color:#263f6e;">Property Not Found</h1>';
        
        try {
            const res = await fetch(`${API_BASE}/api/properties/${id}`);
            const json = await res.json();
            render(json.data || json);
        } catch(e) { console.error(e); }
    };

    function render(p) {
        document.getElementById('breadTitle').innerText = p.title;
        document.getElementById('dispTitle').innerText = p.title;
        document.getElementById('dispPrice').innerText = "₹ " + Number(p.price).toLocaleString('en-IN');
        document.getElementById('dispCity').innerText = p.address?.city || 'India';
        document.getElementById('dispDesc').innerText = p.description || 'N/A';
        document.getElementById('typeTag').innerText = p.propertyType;
        
        document.getElementById('fArea').innerText = p.features?.area || '0';
        document.getElementById('fBeds').innerText = p.features?.bedrooms || 'N/A';
        document.getElementById('fBaths').innerText = p.features?.bathrooms || 'N/A';
        document.getElementById('fPark').innerText = p.features?.parking ? 'Yes' : 'No';

        const amList = Array.isArray(p.amenities) ? p.amenities : (p.amenities?.split(',') || []);
        document.getElementById('amContainer').innerHTML = amList.length ? amList.map(a => `<div class="tag"><i class="fas fa-check-circle"></i> ${a}</div>`).join('') : 'No amenities listed.';

        if(p.owner) {
            document.getElementById('agentName').innerText = p.owner.name || 'YM Agent';
            document.getElementById('agentImg').src = `https://placehold.co/150/263f6e/FFF?text=${(p.owner.name||'A').charAt(0)}`;
            document.getElementById('btnCall').href = `tel:${p.owner.phone}`;
            document.getElementById('btnWa').href = `https://wa.me/${(p.owner.phone||'').replace(/[^0-9]/g,'')}?text=Hi, interested in ${p.title}`;
        }

        setupCarousel(p.images);
    }

    function setupCarousel(imgs) {
        const t = document.getElementById('track');
        if(!imgs || !imgs.length) {
            t.innerHTML = `<div class="carousel-slide"><img src="https://placehold.co/1200x600?text=No+Images"></div>`; return;
        }
        totalSlides = imgs.length;
        t.innerHTML = imgs.map(url => `<div class="carousel-slide"><img src="${getImageUrl(url)}"></div>`).join('');
        updateUI();
    }

    function moveSlide(d) {
        if(totalSlides <= 1) return;
        currentSlide += d;
        if(currentSlide >= totalSlides) currentSlide = 0;
        if(currentSlide < 0) currentSlide = totalSlides - 1;
        document.getElementById('track').style.transform = `translateX(-${currentSlide * 100}%)`;
        updateUI();
    }

    function updateUI() { document.getElementById('imgCount').innerText = `${currentSlide+1}/${totalSlides}`; }
    
    // Swipe
    let tx = 0; const c = document.getElementById('carousel');
    c.addEventListener('touchstart', e => tx = e.changedTouches[0].screenX);
    c.addEventListener('touchend', e => {
        if(e.changedTouches[0].screenX < tx - 50) moveSlide(1);
        if(e.changedTouches[0].screenX > tx + 50) moveSlide(-1);
    });
</script>
</body>
</html>
