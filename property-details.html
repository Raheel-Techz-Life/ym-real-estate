<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Property Details - Y M REAL ESTATE</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
      --primary: #0f172a;       /* Deep Navy */
      --primary-light: #1e293b;
      --accent: #eab308;        /* Gold/Yellow */
      --accent-hover: #ca8a04;
      --text-dark: #1e293b;
      --text-gray: #64748b;
      --bg-gray: #f8fafc;
      --white: #ffffff;
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --radius: 12px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
      font-family: 'Plus Jakarta Sans', sans-serif; 
      background: var(--bg-gray); 
      color: var(--text-dark);
      line-height: 1.6;
    }

    h1, h2, h3, h4 { font-family: 'Outfit', sans-serif; color: var(--primary); }

    /* --- NAVIGATION --- */
    .header {
      background: var(--white);
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 5%;
      position: sticky; top: 0; z-index: 1000;
      box-shadow: var(--shadow-sm);
    }
    .logo-area { display: flex; align-items: center; gap: 12px; text-decoration: none; }
    .logo-img { width: 45px; height: 45px; border-radius: 8px; object-fit: cover; }
    .logo-text { font-size: 20px; font-weight: 700; color: var(--primary); letter-spacing: -0.5px; }

    .nav { display: flex; gap: 30px; }
    .nav a { 
      text-decoration: none; color: var(--text-dark); font-weight: 600; font-size: 15px; 
      transition: color 0.2s; position: relative;
    }
    .nav a:hover { color: var(--accent-hover); }

    /* --- HERO SECTION --- */
    .hero-wrapper {
      position: relative;
      height: 65vh;
      min-height: 400px;
      background: #000;
      overflow: hidden;
    }
    .hero-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0.85;
      transition: transform 10s ease;
    }
    .hero-wrapper:hover .hero-image { transform: scale(1.05); }
    
    .hero-content {
      position: absolute;
      bottom: 0; left: 0; right: 0;
      background: linear-gradient(to top, rgba(15, 23, 42, 0.95) 0%, rgba(15, 23, 42, 0) 100%);
      padding: 120px 5% 40px;
      color: var(--white);
    }
    .hero-badges { display: flex; gap: 10px; margin-bottom: 15px; }
    .badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .badge-sale { background: var(--accent); color: var(--primary); }
    .badge-rent { background: #3b82f6; color: white; }

    .hero-title { font-size: clamp(28px, 4vw, 42px); font-weight: 700; margin-bottom: 8px; line-height: 1.2; }
    .hero-address { font-size: 16px; opacity: 0.9; display: flex; align-items: center; gap: 8px; }
    .hero-price { 
      font-size: 32px; font-weight: 700; color: var(--accent); margin-top: 15px; 
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    /* --- LAYOUT GRID --- */
    .container {
      max-width: 1280px;
      margin: -40px auto 60px; /* Overlap hero slightly */
      padding: 0 20px;
      position: relative;
      z-index: 10;
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 40px;
    }

    /* --- MAIN CONTENT CARD --- */
    .main-card {
      background: var(--white);
      border-radius: var(--radius);
      padding: 40px;
      box-shadow: var(--shadow-lg);
    }

    /* Highlights Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 40px;
      padding-bottom: 30px;
      border-bottom: 1px solid #e2e8f0;
    }
    .stat-item { text-align: center; }
    .stat-icon { font-size: 24px; color: var(--text-gray); margin-bottom: 8px; }
    .stat-value { font-size: 20px; font-weight: 700; color: var(--primary); }
    .stat-label { font-size: 13px; color: var(--text-gray); text-transform: uppercase; letter-spacing: 0.5px; }

    .section-title { font-size: 22px; font-weight: 600; margin-bottom: 20px; color: var(--primary); display: flex; align-items: center; gap: 10px; }
    .section-title::before { content: ''; width: 4px; height: 24px; background: var(--accent); border-radius: 4px; display: block; }

    .description-text { font-size: 16px; color: var(--text-dark); margin-bottom: 40px; white-space: pre-line; }

    /* Amenities Pills */
    .amenities-list { display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 40px; }
    .amenity-pill {
      background: #f1f5f9;
      color: var(--text-dark);
      padding: 10px 18px;
      border-radius: 50px;
      font-size: 14px;
      font-weight: 500;
      display: flex; align-items: center; gap: 8px;
      transition: all 0.2s;
    }
    .amenity-pill:hover { background: #e2e8f0; transform: translateY(-2px); }
    .amenity-pill i { color: var(--accent-hover); }

    /* Gallery Grid */
    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 16px;
    }
    .gallery-img {
      width: 100%; height: 140px; object-fit: cover; border-radius: 8px;
      cursor: pointer; transition: all 0.3s ease;
      box-shadow: var(--shadow-sm);
    }
    .gallery-img:hover { transform: scale(1.03); box-shadow: var(--shadow-md); z-index: 2; }

    /* --- SIDEBAR --- */
    .sidebar-wrapper { position: relative; }
    .sidebar-sticky { position: sticky; top: 110px; }

    .agent-card {
      background: var(--white);
      border-radius: var(--radius);
      padding: 30px;
      box-shadow: var(--shadow-lg);
      border: 1px solid #e2e8f0;
    }
    .agent-header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; }
    .agent-avatar {
      width: 60px; height: 60px; background: var(--primary); color: white;
      border-radius: 50%; display: flex; align-items: center; justify-content: center;
      font-size: 24px;
    }
    .agent-info h3 { font-size: 18px; margin-bottom: 4px; }
    .agent-info span { font-size: 13px; color: var(--text-gray); }

    .contact-row { display: flex; align-items: center; gap: 12px; margin-bottom: 15px; color: var(--text-dark); }
    .contact-row i { color: var(--accent-hover); width: 20px; text-align: center; }
    .contact-row a { color: var(--text-dark); text-decoration: none; font-weight: 500; }
    .contact-row a:hover { color: var(--primary); text-decoration: underline; }

    .btn-contact {
      width: 100%;
      background: var(--primary);
      color: white;
      padding: 14px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 10px;
      transition: background 0.3s;
      display: flex; align-items: center; justify-content: center; gap: 10px;
    }
    .btn-contact:hover { background: var(--primary-light); }
    
    .btn-whatsapp {
      background: #25D366;
      margin-top: 10px;
    }
    .btn-whatsapp:hover { background: #1ebc57; }

    .quick-facts { margin-top: 30px; background: var(--white); padding: 25px; border-radius: var(--radius); box-shadow: var(--shadow-md); }
    .fact-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #f1f5f9; font-size: 14px; }
    .fact-row:last-child { border: none; }
    .fact-label { color: var(--text-gray); }
    .fact-value { font-weight: 600; color: var(--primary); }

    /* --- LOADING STATE --- */
    .loading-container {
      text-align: center;
      padding: 100px 20px;
      color: var(--text-gray);
    }
    .spinner {
      width: 50px; height: 50px;
      border: 4px solid #e2e8f0;
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* --- MOBILE RESPONSIVE --- */
    @media (max-width: 900px) {
      .container { grid-template-columns: 1fr; margin-top: 0; }
      .hero-wrapper { height: 50vh; }
      .hero-title { font-size: 28px; }
      .header { padding: 0 20px; }
      .nav { display: none; } /* Simplified for mobile */
      .stats-grid { grid-template-columns: repeat(2, 1fr); gap: 15px; }
      .sidebar-sticky { position: static; }
      .amenity-pill { flex: 1 1 40%; }
    }
  </style>
</head>
<body>

  <header class="header">
    <a href="index.html" class="logo-area">
      <img src="ym.jpg" alt="Logo" class="logo-img" onerror="this.src='https://placehold.co/50x50?text=YM'">
      <div class="logo-text">Y M REAL ESTATE</div>
    </a>
    <nav class="nav">
      <a href="index.html">Home</a>
      <a href="properties.html">Properties</a>
      <a href="team.html">Our Team</a>
      <a href="contact.html">Contact Us</a>
    </nav>
  </header>

  <div id="propertyHero" class="hero-wrapper">
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Loading Property...</p>
    </div>
  </div>

  <div class="container">
    
    <div class="main-card" id="mainContent">
      <div class="loading-container">
        <p>Loading Details...</p>
      </div>
    </div>

    <div class="sidebar-wrapper">
      <div class="sidebar-sticky">
        
        <div class="agent-card">
          <div class="agent-header">
            <div class="agent-avatar"><i class="fas fa-user-tie"></i></div>
            <div class="agent-info">
              <h3>Listing Agent</h3>
              <span id="agentName">Y M Real Estate</span>
            </div>
          </div>
          
          <div id="contactDetails">
            </div>

          <button class="btn-contact" onclick="window.location.href='contact.html'">
            <i class="far fa-envelope"></i> Send Message
          </button>
          <button class="btn-contact btn-whatsapp" onclick="window.open('https://wa.me/917795811097', '_blank')">
            <i class="fab fa-whatsapp"></i> WhatsApp
          </button>
        </div>

        <div class="quick-facts" id="quickFacts">
          </div>

      </div>
    </div>
  </div>

  <script src="js/api.js"></script>
  <script>
    /* ================================================================
       SMART SCRIPT: FIXES LOCALHOST IMAGES & PREVENTS CRASHES
       ================================================================
    */
    (() => {
      // 1. CONFIGURATION
      const APP_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
        ? 'http://localhost:5011'
        : 'https://ym-real-estate.onrender.com';
      
      const PROPERTY_IMAGES_URL = `${APP_BASE_URL}/uploads/`;
      const PROPERTY_API_ENDPOINT = `${APP_BASE_URL}/api`;

      // 2. SMART IMAGE FIXER
      function resolveImageUrl(imagePath) {
        if (!imagePath) return 'https://placehold.co/1200x800?text=No+Image';
        
        // Fix localhost links stored in DB
        if (imagePath.includes('localhost')) {
          const filename = imagePath.split('/uploads/').pop();
          return `${PROPERTY_IMAGES_URL}${filename}`;
        }
        // Return valid web links
        if (imagePath.startsWith('http')) return imagePath;

        // Clean paths
        const cleanPath = imagePath.replace(/^\\uploads\\/, '').replace(/^\/uploads\//, '');
        return `${PROPERTY_IMAGES_URL}${cleanPath}`;
      }

      // 3. LOAD DATA
      async function loadProperty() {
        const urlParams = new URLSearchParams(window.location.search);
        const propertyId = urlParams.get('id');

        if (!propertyId) return showError("No Property ID specified.");

        try {
          console.log(`Fetching: ${PROPERTY_API_ENDPOINT}/properties/${propertyId}`);
          const response = await fetch(`${PROPERTY_API_ENDPOINT}/properties/${propertyId}`);
          const json = await response.json();
          const property = json.data || json;

          if (!property || json.success === false) throw new Error("Property not found in database.");
          
          renderPage(property);

        } catch (error) {
          console.error(error);
          showError(error.message);
        }
      }

      function showError(msg) {
        document.getElementById('mainContent').innerHTML = `
          <div style="text-align:center; padding: 40px; color: #ef4444;">
            <i class="fas fa-exclamation-circle" style="font-size: 40px; margin-bottom:15px;"></i>
            <h3>Unable to Load Property</h3>
            <p>${msg}</p>
            <a href="properties.html" style="color:var(--primary); font-weight:bold; margin-top:20px; display:inline-block;">&larr; Back to Properties</a>
          </div>
        `;
        document.getElementById('propertyHero').style.display = 'none';
      }

      // 4. RENDER UI
      function renderPage(p) {
        const title = p.title || "Untitled Listing";
        const price = p.price ? "â‚¹ " + Number(p.price).toLocaleString('en-IN') : "Price on Request";
        const address = p.address ? `${p.address.city || ''}, ${p.address.state || ''}` : "Location Unavailable";
        const desc = p.description || "No description provided for this property.";
        const type = p.propertyType || "Property";
        const status = p.status === 'rent' ? 'For Rent' : 'For Sale';
        const statusClass = p.status === 'rent' ? 'badge-rent' : 'badge-sale';

        // Hero Section
        const mainImg = (p.images && p.images.length > 0) ? resolveImageUrl(p.images[0]) : 'https://placehold.co/1200x800?text=Cover+Image';
        
        document.getElementById('propertyHero').innerHTML = `
          <img src="${mainImg}" alt="${title}" class="hero-image" onerror="this.src='https://placehold.co/1200x800?text=Image+Error'">
          <div class="hero-content">
            <div class="hero-badges">
              <span class="badge ${statusClass}">${status}</span>
              <span class="badge" style="background:rgba(255,255,255,0.2); backdrop-filter:blur(5px);">${type}</span>
            </div>
            <h1 class="hero-title">${title}</h1>
            <div class="hero-address"><i class="fas fa-map-marker-alt" style="color:var(--accent)"></i> ${address}</div>
            <div class="hero-price">${price}</div>
          </div>
        `;

        // Features Grid
        const beds = p.features?.bedrooms || '-';
        const baths = p.features?.bathrooms || '-';
        const area = p.features?.area || '-';
        const parking = p.features?.parking ? 'Yes' : 'No';

        // Amenities
        const amenitiesHtml = (p.amenities || []).map(a => 
          `<div class="amenity-pill"><i class="fas fa-check-circle"></i> ${a}</div>`
        ).join('');

        // Gallery
        const galleryHtml = (p.images || []).map(img => 
          `<img src="${resolveImageUrl(img)}" class="gallery-img" onclick="window.open('${resolveImageUrl(img)}', '_blank')" onerror="this.style.display='none'">`
        ).join('');

        // Main Content Injection
        document.getElementById('mainContent').innerHTML = `
          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-icon"><i class="fas fa-bed"></i></div>
              <div class="stat-value">${beds}</div>
              <div class="stat-label">Bedrooms</div>
            </div>
            <div class="stat-item">
              <div class="stat-icon"><i class="fas fa-bath"></i></div>
              <div class="stat-value">${baths}</div>
              <div class="stat-label">Bathrooms</div>
            </div>
            <div class="stat-item">
              <div class="stat-icon"><i class="fas fa-ruler-combined"></i></div>
              <div class="stat-value">${area}</div>
              <div class="stat-label">Sq Ft</div>
            </div>
            <div class="stat-item">
              <div class="stat-icon"><i class="fas fa-car"></i></div>
              <div class="stat-value">${parking}</div>
              <div class="stat-label">Parking</div>
            </div>
          </div>

          <h3 class="section-title">About this Property</h3>
          <p class="description-text">${desc}</p>

          ${amenitiesHtml ? `<h3 class="section-title">Amenities & Features</h3><div class="amenities-list">${amenitiesHtml}</div>` : ''}
          
          ${galleryHtml ? `<h3 class="section-title">Photo Gallery</h3><div class="gallery-grid">${galleryHtml}</div>` : ''}
        `;

        // Sidebar Agent Info
        const ownerName = p.owner?.name || "Y M Real Estate Team";
        const ownerPhone = p.owner?.phone || "+91 77958 11097";
        const ownerEmail = p.owner?.email || "info@ymrealestate.com";

        document.getElementById('agentName').textContent = ownerName;
        document.getElementById('contactDetails').innerHTML = `
          <div class="contact-row"><i class="fas fa-phone"></i> <a href="tel:${ownerPhone}">${ownerPhone}</a></div>
          <div class="contact-row"><i class="fas fa-envelope"></i> <a href="mailto:${ownerEmail}">${ownerEmail}</a></div>
        `;

        // Quick Facts
        document.getElementById('quickFacts').innerHTML = `
          <h4 style="margin-bottom:15px; font-size:16px;">Property Details</h4>
          <div class="fact-row"><span class="fact-label">Property ID</span><span class="fact-value">#${p._id ? p._id.slice(-6).toUpperCase() : 'N/A'}</span></div>
          <div class="fact-row"><span class="fact-label">Year Built</span><span class="fact-value">${p.features?.yearBuilt || 'N/A'}</span></div>
          <div class="fact-row"><span class="fact-label">Furnished</span><span class="fact-value">${p.features?.furnished ? 'Yes' : 'No'}</span></div>
          <div class="fact-row"><span class="fact-label">Date Listed</span><span class="fact-value">${new Date().toLocaleDateString()}</span></div>
        `;
      }

      // Start
      document.addEventListener('DOMContentLoaded', loadProperty);
    })();
  </script>
</body>
</html>
