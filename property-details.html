<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Property Details | Y M REAL ESTATE</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    /* --- THEME VARIABLES (Matching Admin) --- */
    :root {
        --primary: #0f172a;       /* Deep Navy */
        --accent: #4f46e5;        /* Indigo */
        --accent-hover: #4338ca;
        --bg: #f8fafc;            /* Light Gray */
        --surface: #ffffff;
        --text-main: #1e293b;
        --text-sub: #64748b;
        --gold: #f59e0b;          /* Gold for Price/Stars */
        --border: #e2e8f0;
        --radius: 16px;
        --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
    body { background: var(--bg); color: var(--text-main); padding-top: 80px; }
    a { text-decoration: none; color: inherit; }

    /* --- NAVIGATION --- */
    .header {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid var(--border);
        padding: 15px 5%;
        display: flex; justify-content: space-between; align-items: center;
        position: fixed; top: 0; width: 100%; z-index: 1000;
    }
    .brand { font-size: 1.5rem; font-weight: 800; color: var(--primary); display: flex; align-items: center; gap: 10px; }
    .brand span { color: var(--accent); }
    
    .nav-links { display: flex; gap: 25px; }
    .nav-links a { font-weight: 600; color: var(--text-sub); transition: 0.2s; }
    .nav-links a:hover { color: var(--accent); }

    /* --- LAYOUT --- */
    .container { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
    
    .breadcrumb { margin-bottom: 20px; color: var(--text-sub); font-size: 0.9rem; }
    .breadcrumb a { color: var(--accent); font-weight: 600; }

    /* --- CAROUSEL (SLIDER) --- */
    .carousel-wrapper {
        position: relative;
        width: 100%;
        height: 60vh; /* Large height for impact */
        min-height: 400px;
        max-height: 600px;
        border-radius: var(--radius);
        overflow: hidden;
        margin-bottom: 30px;
        background: #e2e8f0;
        box-shadow: var(--shadow);
    }
    
    .carousel-track {
        display: flex;
        height: 100%;
        transition: transform 0.4s ease-out;
    }
    
    .carousel-slide {
        min-width: 100%;
        height: 100%;
    }
    
    .carousel-slide img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* Navigation Arrows */
    .carousel-btn {
        position: absolute; top: 50%; transform: translateY(-50%);
        background: rgba(255, 255, 255, 0.9);
        color: var(--primary);
        border: none;
        width: 45px; height: 45px;
        border-radius: 50%;
        cursor: pointer;
        display: flex; align-items: center; justify-content: center;
        font-size: 1.2rem;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        transition: 0.2s;
        z-index: 10;
    }
    .carousel-btn:hover { background: var(--accent); color: white; }
    .btn-prev { left: 20px; }
    .btn-next { right: 20px; }

    /* Image Counter Badge */
    .image-badge {
        position: absolute; bottom: 20px; right: 20px;
        background: rgba(0,0,0,0.7); color: white;
        padding: 6px 14px; border-radius: 20px;
        font-size: 0.85rem; font-weight: 600;
        backdrop-filter: blur(4px);
    }

    /* --- MAIN CONTENT GRID --- */
    .content-grid {
        display: grid;
        grid-template-columns: 2fr 1fr; /* 2/3 for content, 1/3 for agent */
        gap: 40px;
    }

    /* LEFT COLUMN */
    .main-info {
        background: var(--surface);
        padding: 30px;
        border-radius: var(--radius);
        border: 1px solid var(--border);
    }

    .prop-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; flex-wrap: wrap; gap: 15px; }
    .prop-title { font-size: 2rem; font-weight: 800; color: var(--primary); line-height: 1.2; margin-bottom: 5px; }
    .prop-location { color: var(--text-sub); display: flex; align-items: center; gap: 8px; font-size: 1rem; }
    
    .prop-price { 
        font-size: 1.8rem; font-weight: 800; color: var(--accent); 
        background: #eef2ff; padding: 10px 20px; border-radius: 12px;
    }

    /* Key Features Row */
    .features-row {
        display: flex; gap: 20px; margin: 30px 0; padding: 20px 0;
        border-top: 1px solid var(--border); border-bottom: 1px solid var(--border);
        flex-wrap: wrap;
    }
    .feature-item { display: flex; align-items: center; gap: 10px; color: var(--text-main); font-weight: 600; }
    .feature-item i { color: var(--accent); font-size: 1.2rem; }

    .section-title { font-size: 1.2rem; font-weight: 700; color: var(--primary); margin-bottom: 15px; margin-top: 30px; }
    .description { line-height: 1.8; color: var(--text-sub); white-space: pre-line; }

    /* Amenities Tags */
    .amenities-list { display: flex; flex-wrap: wrap; gap: 10px; }
    .amenity-tag {
        background: #f1f5f9; padding: 8px 16px; border-radius: 50px;
        font-size: 0.9rem; font-weight: 500; color: var(--text-main);
        display: flex; align-items: center; gap: 8px;
    }
    .amenity-tag i { color: var(--success, #10b981); }

    /* RIGHT COLUMN (AGENT) */
    .agent-sidebar { position: sticky; top: 100px; height: fit-content; }
    
    .agent-card {
        background: var(--primary);
        color: white;
        padding: 30px;
        border-radius: var(--radius);
        text-align: center;
        box-shadow: 0 20px 25px -5px rgba(15, 23, 42, 0.3);
    }
    
    .agent-avatar {
        width: 100px; height: 100px; border-radius: 50%;
        border: 4px solid rgba(255,255,255,0.2);
        margin-bottom: 15px; object-fit: cover; background: white;
    }
    
    .agent-name { font-size: 1.3rem; font-weight: 700; margin-bottom: 5px; }
    .agent-role { opacity: 0.8; font-size: 0.9rem; margin-bottom: 25px; }

    .action-btn {
        display: flex; align-items: center; justify-content: center; gap: 10px;
        width: 100%; padding: 14px; border-radius: 10px;
        font-weight: 600; margin-bottom: 10px; transition: 0.2s; cursor: pointer;
    }
    .btn-call { background: white; color: var(--primary); }
    .btn-call:hover { background: #e2e8f0; }
    
    .btn-whatsapp { background: #25D366; color: white; }
    .btn-whatsapp:hover { background: #1ebc57; }

    /* --- MOBILE RESPONSIVE --- */
    @media (max-width: 900px) {
        .content-grid { grid-template-columns: 1fr; }
        .carousel-wrapper { height: 40vh; min-height: 300px; }
        .prop-header { flex-direction: column; }
        .prop-price { width: 100%; text-align: center; }
        .header { padding: 15px; }
        .nav-links { display: none; } /* Hide nav on mobile for simplicity */
    }
  </style>
</head>
<body>

<nav class="header">
    <div class="brand"><i class="fas fa-building"></i> YM <span>REAL ESTATE</span></div>
    <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="properties.html">Properties</a>
        <a href="contact.html">Contact</a>
    </div>
</nav>

<div class="container">
    <div class="breadcrumb">
        <a href="index.html">Home</a> / <a href="properties.html">Properties</a> / <span id="breadTitle">Loading...</span>
    </div>

    <div class="carousel-wrapper" id="carousel">
        <div class="carousel-track" id="track">
            </div>
        
        <button class="carousel-btn btn-prev" onclick="moveSlide(-1)">&#10094;</button>
        <button class="carousel-btn btn-next" onclick="moveSlide(1)">&#10095;</button>
        
        <div class="image-badge" id="imageCount">1 / 1</div>
    </div>

    <div class="content-grid">
        
        <div class="main-info">
            <div class="prop-header">
                <div>
                    <div style="display:flex; gap:10px; margin-bottom:10px;">
                        <span style="background:#dbeafe; color:#1e40af; padding:4px 12px; border-radius:20px; font-size:0.8rem; font-weight:700;" id="tagType">House</span>
                        <span style="background:#dcfce7; color:#166534; padding:4px 12px; border-radius:20px; font-size:0.8rem; font-weight:700;" id="tagStatus">For Sale</span>
                    </div>
                    <h1 class="prop-title" id="displayTitle">Loading Property...</h1>
                    <div class="prop-location"><i class="fas fa-map-marker-alt"></i> <span id="displayCity">...</span></div>
                </div>
                <div class="prop-price" id="displayPrice">₹...</div>
            </div>

            <div class="features-row">
                <div class="feature-item"><i class="fas fa-ruler-combined"></i> <span id="featArea">-</span></div>
                <div class="feature-item"><i class="fas fa-bed"></i> <span id="featBeds">-</span> Beds</div>
                <div class="feature-item"><i class="fas fa-bath"></i> <span id="featBaths">-</span> Baths</div>
                <div class="feature-item"><i class="fas fa-car"></i> <span id="featParking">No</span> Parking</div>
            </div>

            <h3 class="section-title">Description</h3>
            <p class="description" id="displayDesc">No description available.</p>

            <h3 class="section-title">Amenities</h3>
            <div class="amenities-list" id="amenitiesContainer">
                </div>
            
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border);">
                 <h3 class="section-title">Additional Details</h3>
                 <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; color: var(--text-sub);">
                     <div><strong>Plot Area:</strong> <span id="detailPlot">-</span></div>
                     <div><strong>Furnishing:</strong> <span id="detailFurnish">Semi-Furnished</span></div>
                     <div><strong>Listing Date:</strong> <span id="detailDate">-</span></div>
                 </div>
            </div>
        </div>

        <div class="agent-sidebar">
            <div class="agent-card">
                <img src="https://placehold.co/150" class="agent-avatar" id="agentImg">
                <h3 class="agent-name" id="agentName">Y M Agent</h3>
                <p class="agent-role">Property Consultant</p>
                
                <a href="#" class="action-btn btn-call" id="btnCall"><i class="fas fa-phone"></i> Call Now</a>
                <a href="#" class="action-btn btn-whatsapp" id="btnWhatsapp"><i class="fab fa-whatsapp"></i> Chat on WhatsApp</a>
                
                <div style="margin-top: 20px; font-size: 0.85rem; opacity: 0.7;">
                    Reference ID: <span id="refId">...</span>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    // --- CONFIGURATION ---
    // Detect if localhost or production
    const API_BASE = window.location.hostname === 'localhost' 
        ? 'http://localhost:5011' 
        : 'https://ym-real-estate.onrender.com';

    let currentSlide = 0;
    let totalSlides = 0;

    // --- INITIALIZATION ---
    window.onload = async () => {
        const urlParams = new URLSearchParams(window.location.search);
        const propId = urlParams.get('id');

        if (!propId) {
            document.querySelector('.container').innerHTML = '<h2 style="text-align:center; margin-top:50px;">Property Not Found</h2>';
            return;
        }

        try {
            const res = await fetch(`${API_BASE}/api/properties/${propId}`);
            const json = await res.json();
            const data = json.data || json; // Handle wrapped or direct data
            
            renderPage(data);
        } catch (err) {
            console.error(err);
            alert("Error loading property details.");
        }
    };

    // --- RENDER FUNCTION ---
    function renderPage(p) {
        // 1. Text Fields
        document.getElementById('breadTitle').innerText = p.title;
        document.getElementById('displayTitle').innerText = p.title;
        document.getElementById('displayPrice').innerText = "₹ " + Number(p.price).toLocaleString('en-IN');
        document.getElementById('displayCity').innerText = (p.address?.city || 'India');
        document.getElementById('displayDesc').innerText = p.description || "No description provided.";
        document.getElementById('refId').innerText = p._id.slice(-6).toUpperCase();
        document.getElementById('detailDate').innerText = new Date().toLocaleDateString(); // Placeholder or created_at

        // 2. Badges
        document.getElementById('tagType').innerText = p.propertyType;
        document.getElementById('tagStatus').innerText = p.status === 'rent' ? 'For Rent' : 'For Sale';

        // 3. Features (Handle missing data safely)
        document.getElementById('featArea').innerText = (p.features?.area || '0') + ' sqft';
        document.getElementById('featBeds').innerText = p.features?.bedrooms || 'N/A';
        document.getElementById('featBaths').innerText = p.features?.bathrooms || 'N/A';
        document.getElementById('featParking').innerText = p.features?.parking ? 'Yes' : 'No';
        document.getElementById('detailPlot').innerText = (p.features?.plotArea || 'N/A') + ' sqft';

        // 4. Amenities
        const amList = document.getElementById('amenitiesContainer');
        if(p.amenities && p.amenities.length > 0) {
            // Handle if amenities is a string "Wifi, Pool" or array ["Wifi", "Pool"]
            let amArray = Array.isArray(p.amenities) ? p.amenities : p.amenities.split(',');
            amList.innerHTML = amArray.map(a => 
                `<div class="amenity-tag"><i class="fas fa-check-circle"></i> ${a.trim()}</div>`
            ).join('');
        } else {
            amList.innerHTML = '<span style="color:#aaa">No specific amenities listed.</span>';
        }

        // 5. Agent Info
        if(p.owner) {
            document.getElementById('agentName').innerText = p.owner.name || 'YM Agent';
            const phone = p.owner.phone || '';
            document.getElementById('btnCall').href = `tel:${phone}`;
            document.getElementById('btnWhatsapp').href = `https://wa.me/${phone.replace(/[^0-9]/g, '')}?text=I'm interested in ${encodeURIComponent(p.title)}`;
            // Optional: Generate Avatar from initials
            document.getElementById('agentImg').src = `https://placehold.co/150/0f172a/FFF?text=${(p.owner.name || 'A').charAt(0)}`;
        }

        // 6. CAROUSEL IMAGES
        setupCarousel(p.images);
    }

    // --- CAROUSEL LOGIC ---
    function setupCarousel(images) {
        const track = document.getElementById('track');
        
        if (!images || images.length === 0) {
            // Fallback image
            track.innerHTML = `<div class="carousel-slide"><img src="https://placehold.co/1200x600?text=No+Image+Available"></div>`;
            document.querySelector('.image-badge').style.display = 'none';
            return;
        }

        totalSlides = images.length;
        
        // Render Images
        track.innerHTML = images.map(url => {
            // Fix URL if it's relative
            const fullUrl = (url.startsWith('http')) ? url : `${API_BASE}/uploads/${url.split(/[/\\]/).pop()}`;
            return `<div class="carousel-slide"><img src="${fullUrl}" onerror="this.src='https://placehold.co/1200x600?text=Error'"></div>`;
        }).join('');

        updateCarouselUI();
    }

    function moveSlide(dir) {
        if (totalSlides <= 1) return;
        currentSlide += dir;
        
        if (currentSlide >= totalSlides) currentSlide = 0;
        if (currentSlide < 0) currentSlide = totalSlides - 1;
        
        const track = document.getElementById('track');
        track.style.transform = `translateX(-${currentSlide * 100}%)`;
        
        updateCarouselUI();
    }

    function updateCarouselUI() {
        document.getElementById('imageCount').innerText = `${currentSlide + 1} / ${totalSlides}`;
    }

    // --- TOUCH SWIPE LOGIC (Mobile) ---
    let touchStartX = 0;
    const slider = document.getElementById('carousel');
    
    slider.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; });
    slider.addEventListener('touchend', e => {
        let touchEndX = e.changedTouches[0].screenX;
        if (touchEndX < touchStartX - 50) moveSlide(1); // Swipe Left -> Next
        if (touchEndX > touchStartX + 50) moveSlide(-1); // Swipe Right -> Prev
    });

</script>

</body>
</html>
