<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Details | Y M REAL ESTATE</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    /* NAVY THEME */
    :root { --primary: #263f6e; --accent: #ffd700; --bg: linear-gradient(135deg, #f6faff 0%, #e8f0fe 100%); }
    body { margin:0; font-family:'Segoe UI', sans-serif; background:var(--bg); padding-bottom:40px; }

    /* HEADER STYLES */
    .header { 
        background: #263f6e; 
        color: #fff; 
        padding: 15px 40px; 
        display: flex; 
        justify-content: space-between; 
        align-items: center;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
        position: sticky; 
        top: 0; 
        z-index: 1000; 
    }

    .logo-area { 
        display: flex; align-items: center; gap: 15px;
        text-decoration: none; color: white; font-weight: bold; font-size: 1.4rem; 
    }

    .logo-img { height: 45px; width: auto; border-radius: 5px; }

    .nav-links {
        display: flex;
        align-items: center;
    }

    .nav-links a {
        color: rgba(255,255,255,0.9); text-decoration: none; margin-left: 25px;
        font-weight: 500; font-size: 1rem; transition: color 0.3s;
    }
    .nav-links a:hover { color: #ffd700; }
    
    .container { max-width:1100px; margin:30px auto; padding:0 20px; }
    
    /* SLIDER */
    .slider { position:relative; height:450px; background:#ddd; border-radius:15px; overflow:hidden; margin-bottom:30px; box-shadow:0 10px 30px rgba(0,0,0,0.1); }
    .slide-track { display:flex; height:100%; transition:transform 0.4s; }
    .slide { min-width:100%; height:100%; }
    .slide img { width:100%; height:100%; object-fit:cover; }
    .arrow { position:absolute; top:50%; transform:translateY(-50%); background:rgba(255,255,255,0.8); border:none; width:40px; height:40px; border-radius:50%; cursor:pointer; font-size:20px; color:var(--primary); }
    .prev { left:20px; } .next { right:20px; }
    .badge { position:absolute; bottom:20px; right:20px; background:rgba(38,63,110,0.8); color:white; padding:5px 15px; border-radius:20px; }

    /* MAIN LAYOUT GRID (Left: Details, Right: Agent) */
    .layout-grid { display:grid; grid-template-columns:2fr 1fr; gap:30px; align-items: start; }

    /* DETAILS GRID (The new Box UI) */
    .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); /* Min width 200px */
        gap: 15px;
        margin-bottom: 20px;
    }

    /* THE INFO BOX STYLES */
    .info-box {
        background: #fff;
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        padding: 20px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .info-box:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.08); border-color:#cbd5e1; }

    .info-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #64748b; font-weight: 700; margin-bottom: 8px; }
    
    .info-value { font-size: 1.1rem; font-weight: 600; color: #1e293b; word-break: break-word; }
    .info-value.highlight { font-size: 1.4rem; color: var(--primary); font-weight: 800; }
    .info-value .unit { font-size: 0.9rem; font-weight: 400; color: #94a3b8; margin-left:4px; }

    /* Full Width Box (For Description/Amenities) */
    .wide-box { grid-column: 1 / -1; }
    .paragraph-text { line-height: 1.7; color: #475569; font-size: 0.95rem; }

    /* Chips for Amenities */
    .amenity-chip { 
        display: inline-block; background: #eff6ff; color: #1d4ed8; 
        padding: 6px 14px; border-radius: 20px; font-size: 0.85rem; font-weight: 500; 
        margin: 0 8px 8px 0; border: 1px solid #dbeafe;
    }

    /* AGENT BOX */
    .agent-box { text-align:center; background:var(--primary); color:white; padding:30px; border-radius:15px; position:sticky; top:100px; }
    .agent-img { width:100px; height:100px; border-radius:50%; background:white; object-fit:cover; border:3px solid rgba(255,255,255,0.3); margin-bottom:15px; }
    .btn { display:block; padding:12px; margin-top:10px; border-radius:8px; text-decoration:none; font-weight:bold; transition: opacity 0.2s; }
    .btn:hover { opacity: 0.9; }
    .btn-wa { background:#25D366; color:white; }

    /* --- RESPONSIVE CSS --- */
    /* This section handles the mobile resizing */
    @media(max-width:800px) { 
        /* Stack the main grid (Details top, Agent bottom) */
        .layout-grid { grid-template-columns:1fr; } 
        
        /* Reduce slider height */
        .slider { height:300px; } 

        /* Header Mobile Fix */
        .header {
            flex-direction: column; /* Stack logo on top of links */
            padding: 15px 20px;
            gap: 15px; /* Add space between logo and links */
        }
        
        .nav-links {
            width: 100%;
            justify-content: center;
            flex-wrap: wrap; /* Allow links to wrap if screen is very small */
            gap: 15px;
        }

        .nav-links a {
            margin-left: 0; /* Remove left margin */
            font-size: 0.9rem;
            padding: 5px;
        }

        /* Fix Agent Box sticky issue on mobile */
        .agent-box {
            position: relative;
            top: 0;
        }
    }
  </style>
</head>
<body>

<div class="header">
    <a href="index.html" class="logo-area">
        <img src="ymr.jpg" alt="YM Logo" class="logo-img" onerror="this.style.display='none'"> 
        <span>YM REAL ESTATE</span>
    </a>
    <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="properties.html">Properties</a>
        <a href="contact.html">Contact</a>
        <a href="login.html" id="authBtn" style="background:rgba(255,255,255,0.2); padding:8px 15px; border-radius:5px;">Login</a>
    </div>
</div>
  
<div class="container">
    
    <div class="slider" id="slider">
        <div class="slide-track" id="track"></div>
        <button class="arrow prev" onclick="move(-1)">&#10094;</button>
        <button class="arrow next" onclick="move(1)">&#10095;</button>
        <div class="badge" id="counter">1/1</div>
    </div>

    <div class="layout-grid">
        
        <div class="details-wrapper">
            <h1 id="page-title" style="margin-top:0; color:var(--primary); margin-bottom:20px;">Loading...</h1>

            <div id="details-grid" class="dashboard-grid">
                </div>
        </div>

        <div class="agent-box">
            <img src="https://placehold.co/100" class="agent-img" id="aImg">
            <h3 id="aName">Agent</h3>
            <p>Property Consultant</p>
            <a href="#" class="btn btn-wa" id="btnWa"><i class="fab fa-whatsapp"></i> WhatsApp</a>
            <a href="#" class="btn" style="background:white; color:var(--primary);" id="btnCall"><i class="fas fa-phone"></i> Call Now</a>
        </div>

    </div>
</div>

<script>
    const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    const API = isLocal ? 'http://localhost:5011' : 'https://ym-real-estate.onrender.com';

    function getImgUrl(path) {
        if (!path) return 'https://placehold.co/1200x600?text=No+Image';
        if (path.startsWith('http')) return path;
        const filename = path.split(/[/\\]/).pop();
        return `${API}/uploads/${filename}`;
    }

    // Dynamic Box Creator
    function createBox(label, value, isHighlight = false, unit = '') {
        if (value === null || value === undefined || value === '' || value === 0) return '';
        
        return `
            <div class="info-box">
                <div class="info-label">${label}</div>
                <div class="info-value ${isHighlight ? 'highlight' : ''}">
                    ${value} ${unit ? `<span class="unit">${unit}</span>` : ''}
                </div>
            </div>
        `;
    }

    let curr = 0; let total = 0;

    window.onload = async () => {
        const id = new URLSearchParams(window.location.search).get('id');
        if(!id) return document.body.innerHTML = "<h1 style='text-align:center; margin-top:50px'>Property Not Found</h1>";

        try {
            const res = await fetch(`${API}/api/properties/${id}`);
            const d = await res.json();
            const p = d.data || d;

            document.getElementById('page-title').innerText = p.title;

            // BUILD GRID
            const grid = document.getElementById('details-grid');
            let html = '';

            html += createBox('Price', 'â‚¹ ' + Number(p.price).toLocaleString(), true);
            html += createBox('Location', p.address?.city || 'Unknown');
            html += createBox('Type', p.propertyType);
            
            if(p.features) {
                html += createBox('Area', p.features.area, true, 'sq ft');
                html += createBox('Bedrooms', p.features.bedrooms);
                html += createBox('Bathrooms', p.features.bathrooms);
            }

            // Description
            if(p.description) {
                html += `
                    <div class="info-box wide-box">
                        <div class="info-label">Description</div>
                        <div class="paragraph-text">${p.description}</div>
                    </div>
                `;
            }

            // Amenities
            const am = p.amenities ? (Array.isArray(p.amenities) ? p.amenities : p.amenities.split(',')) : [];
            if(am.length > 0) {
                const chips = am.map(a => `<span class="amenity-chip">${a.trim()}</span>`).join('');
                html += `
                    <div class="info-box wide-box">
                        <div class="info-label">Amenities</div>
                        <div style="margin-top:5px;">${chips}</div>
                    </div>
                `;
            }

            grid.innerHTML = html;

            // Agent
            if(p.owner) {
                document.getElementById('aName').innerText = p.owner.name;
                document.getElementById('aImg').src = `https://placehold.co/100/263f6e/FFF?text=${p.owner.name[0]}`;
                document.getElementById('btnCall').href = `tel:${p.owner.phone}`;
                document.getElementById('btnWa').href = `https://wa.me/${p.owner.phone.replace(/\D/g,'')}?text=Hi, interested in ${p.title}`;
            }

            setupSlider(p.images);

        } catch (err) {
            console.error(err);
        }
    };

    function setupSlider(imgs) {
        const t = document.getElementById('track');
        if(!imgs || !imgs.length) { t.innerHTML = `<div class="slide"><img src="https://placehold.co/800x400?text=No+Image"></div>`; return; }
        
        total = imgs.length;
        t.innerHTML = imgs.map(url => `<div class="slide"><img src="${getImgUrl(url)}"></div>`).join('');
        updateUI();
    }

    function move(d) {
        if(total < 2) return;
        curr += d;
        if(curr >= total) curr = 0;
        if(curr < 0) curr = total - 1;
        document.getElementById('track').style.transform = `translateX(-${curr * 100}%)`;
        updateUI();
    }
    
    function updateUI() {
        document.getElementById('counter').innerText = `${curr+1}/${total}`;
    }
    
    document.addEventListener("DOMContentLoaded", function() {
        const u = localStorage.getItem('user');
        const authBtn = document.getElementById('authBtn');
        if (u && authBtn) {
            const user = JSON.parse(u);
            const email = (user.email || "").toLowerCase();
            const isTester = ['team', 'test', 'tester', 'ym'].some(keyword => email.includes(keyword));
            const isAdmin = user.role === 'admin' || user.role === 'team' || isTester;

            if (isAdmin) {
                authBtn.innerText = "Admin Panel";
                authBtn.href = "admin.html";
                authBtn.style.background = "#2ecc71"; 
            } else {
                authBtn.innerText = "Logout";
                authBtn.href = "#";
                authBtn.onclick = function() { localStorage.clear(); window.location.reload(); };
            }
        }
    });
</script>
</body>
</html>
