<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Y M REAL ESTATE</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="js/api.js" defer></script>
  <style>
    /* --- 1. RESET --- */
    html, body {
      width: 100%; max-width: 100%; overflow-x: hidden; margin: 0; padding: 0;
      box-sizing: border-box; font-family: 'Poppins', sans-serif;
      background: #ffffff; color: #2d3748;
    }
    *, *::before, *::after { box-sizing: inherit; }
    :root { --primary-color: #263f6e; --primary-light: #f6faff; --primary-dark: #18284b; --accent-color: #ffd700; }

    /* HEADER */
    .header {
      background: rgba(255, 255, 255, 0.98); padding: 15px 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; align-items: center;
      justify-content: space-between; position: fixed; width: 100%; top: 0; left: 0; z-index: 1000;
    }
    .logo-area { display: flex; align-items: center; text-decoration: none; gap: 12px; }
    .logo-img { height: 50px; width: auto; max-width: 120px; object-fit: contain; }
    .nav { display: flex; gap: 24px; }
    .nav a { color: #2d3748; text-decoration: none; font-weight: 500; padding: 10px 15px; border-radius: 8px; transition: 0.3s; }
    .nav a:hover { background: #f3f7ff; color: var(--primary-color); }
    .user-profile { display: none; align-items: center; gap: 12px; margin-left: auto; }

    /* HERO */
    .hero-section {
      height: 85vh; min-height: 500px;
      background: linear-gradient(rgba(38, 63, 110, 0.85), rgba(24, 40, 75, 0.9)),
                  url('https://images.unsplash.com/photo-1582407947304-fd86f028f716?ixlib=rb-4.0.3');
      background-size: cover; background-position: center;
      display: flex; align-items: center; justify-content: center; text-align: center; color: #fff;
      padding: 80px 20px 0; margin-bottom: 60px;
    }
    .hero-content { max-width: 900px; animation: fadeIn 1s ease-out; }
    .hero-title { font-size: 3rem; font-weight: 700; margin-bottom: 1.5rem; line-height: 1.2; }
    .hero-cta { display: inline-block; padding: 15px 40px; background: var(--accent-color); color: var(--primary-dark); text-decoration: none; border-radius: 50px; font-weight: 600; font-size: 1.1rem; transition: 0.3s; }
    @keyframes fadeIn { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }

    /* SECTIONS */
    .main-container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
    .intro-section { text-align: center; max-width: 800px; margin: 0 auto 60px; padding: 40px; background: #f8faff; border-radius: 20px; }
    
    /* STATS (FIXED NO LEAKING) */
    .stats-circles { display: flex; justify-content: center; gap: 40px; flex-wrap: wrap; margin: 60px 0; }
    .stat-circle {
      width: 160px; height: 160px; border-radius: 50%;
      background: linear-gradient(135deg, #263f6e 0%, #18284b 100%);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      box-shadow: 0 10px 30px rgba(38,63,110,0.3); position: relative;
      padding: 10px; overflow: hidden; /* Stops leaking */
    }
    .stat-circle::before { content: ''; position: absolute; inset: -5px; border-radius: 50%; border: 5px solid #ffd700; opacity: 0.3; }
    .circle-number { font-size: 2.5em; font-weight: 700; color: #ffd700; line-height: 1; margin-bottom: 5px; }
    .circle-label { font-size: 0.9em; color: #fff; line-height: 1.2; text-align: center; }

    /* PROPERTIES */
    .properties-section { background: #f6faff; padding: 60px 0; margin-bottom: 60px; }
    .properties-row { display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; max-width: 1200px; margin: 0 auto; padding: 0 20px; }
    .property-card {
      background: #fff; border-radius: 15px; overflow: hidden; width: 350px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05); transition: 0.3s; cursor: pointer;
    }
    .property-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
    .property-card img { width: 100%; height: 220px; object-fit: cover; }
    .property-desc { padding: 15px; font-weight: 600; font-size: 1.1em; color: var(--primary-color); text-align: center; }

    /* SOCIALS */
    .instagram-section { margin: 60px 0; padding: 30px 0; }
    .instagram-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
    .insta-card {
      aspect-ratio: 1; background: #fff; border-radius: 15px; display: flex; align-items: center; justify-content: center;
      text-decoration: none; overflow: hidden; position: relative; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .insta-card-video { width: 100%; height: 100%; object-fit: cover; }
    .insta-placeholder { text-align: center; color: var(--primary-color); }
    .insta-placeholder i { font-size: 3em; margin-bottom: 10px; display: block; }

    /* TEAM & VALUES */
    .values-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; margin-top: 30px; }
    .value-card { background: #fff; padding: 30px; border-radius: 15px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
    .value-icon { font-size: 2em; color: var(--primary-color); margin-bottom: 15px; }
    
    .team-section { margin: 80px 0; text-align: center; }
    .team-members { display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; margin-top: 30px; }
    .team-card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); width: 250px; }
    .team-card img { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 15px; border: 3px solid var(--primary-color); }

    /* FOOTER (FIXED) */
    .footer {
      background: #0f172a; color: #94a3b8; padding: 60px 20px 20px; margin-top: 80px;
    }
    .footer-content {
      max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 40px;
    }
    .footer-col h3 { color: #fff; margin-bottom: 20px; }
    .footer-col ul { list-style: none; padding: 0; }
    .footer-col li { margin-bottom: 10px; }
    .footer-col a { color: #94a3b8; text-decoration: none; }
    .footer-bottom { text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); }

    /* EDIT BUTTON */
    .edit-reels-fab {
      position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px;
      background: linear-gradient(135deg, #e1306c, #c13584); color: white; border-radius: 50%;
      display: none; align-items: center; justify-content: center; font-size: 24px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer; z-index: 2000;
    }
    .edit-reels-fab.show { display: flex; }

    /* MOBILE RESPONSIVE */
    @media (max-width: 768px) {
      .header { flex-direction: column; padding: 15px; gap: 15px; }
      .nav { flex-wrap: wrap; justify-content: center; width: 100%; gap: 10px; }
      .hero-section { height: auto; min-height: 50vh; padding: 140px 20px 60px; }
      .hero-title { font-size: 2rem; }
      .properties-row, .instagram-grid, .team-members { flex-direction: column; align-items: center; }
      .property-card, .team-card, .insta-card { width: 100%; max-width: 100%; }
      .footer-content { text-align: center; }
    }
  </style>
</head>
<body>

  <div class="header">
    <a href="index.html" class="logo-area">
      <img src="logo.jpg" alt="YM Logo" class="logo-img"> 
      <span style="font-size: 1.4em; font-weight: bold; color: #263f6e;">Y M REAL ESTATE</span>
    </a>
    <div class="nav">
      <a href="properties.html">Properties</a>
      <a href="team.html">Team</a>
      <a href="login.html" id="navLoginLink">Login</a>
      <a href="contact.html">Contact</a>
    </div>
    <div class="user-profile" id="userProfile">
      <img id="userAvatar" src="" alt="User" style="width: 35px; height: 35px; border-radius: 50%;">
      <span id="userName" style="font-weight: 600; font-size: 0.9em;"></span>
      <button onclick="logout()" style="margin-left:10px; padding: 5px 10px; cursor: pointer;">Logout</button>
    </div>
  </div>

  <div class="hero-section">
    <div class="hero-content">
      <h1 class="hero-title">Your Dream Home Awaits</h1>
      <p style="font-size: 1.2rem; margin-bottom: 30px;">Discover exceptional properties with India's most trusted partner.</p>
      <a href="properties.html" class="hero-cta">Explore Properties</a>
    </div>
  </div>

  <div class="main-container">
    
    <div class="intro-section">
      <h2 style="color:var(--primary-color);">Welcome to Y M Real Estate</h2>
      <p style="line-height:1.8; color:#555;">We specialize in connecting clients with properties that match their goals—from dream homes to profitable investments. Your vision is our mission.</p>
    </div>

    <div class="stats-circles-section">
      <div class="stats-circles">
        <div class="stat-circle"><div class="circle-number">6</div><div class="circle-label">Completed<br>Projects</div></div>
        <div class="stat-circle"><div class="circle-number">8</div><div class="circle-label">Upcoming<br>Projects</div></div>
        <div class="stat-circle"><div class="circle-number">02+</div><div class="circle-label">Cities</div></div>
      </div>
    </div>

    <div class="properties-section">
      <h2 style="text-align:center; color:var(--primary-color); margin-bottom:30px;">Featured Properties</h2>
      <div class="properties-row" id="featuredProperties">
        <p style="text-align:center; width:100%; color:#888;">Loading...</p>
      </div>
      <div style="text-align:center; margin-top:30px;">
        <a href="properties.html" style="color:var(--primary-color); font-weight:600;">View All Properties ➜</a>
      </div>
    </div>

    <div class="instagram-section">
      <h2 class="section-title"><i class="fab fa-instagram" style="color:#e1306c"></i> Instagram Reels</h2>
      <div class="instagram-grid" id="instagramGrid"></div>
    </div>

    <div class="instagram-section" style="background:#fff0f0;">
      <h2 class="section-title"><i class="fab fa-youtube" style="color:#ff0000"></i> YouTube Channel</h2>
      <div class="instagram-grid" id="youtubeGrid"></div>
    </div>

    <div class="instagram-section" style="background:#f0f6ff;">
      <h2 class="section-title"><i class="fab fa-facebook" style="color:#1877f2"></i> Facebook Posts</h2>
      <div class="instagram-grid" id="facebookGrid"></div>
    </div>

    <div style="text-align:center; margin:80px 0; padding:40px; background:var(--primary-color); color:white; border-radius:20px;">
      <img src="https://placehold.co/150x150?text=Founder" style="width:150px; height:150px; border-radius:50%; border:5px solid white; margin-bottom:20px;">
      <h3>Yunus Mulla</h3>
      <p style="opacity:0.9;">Founder & CEO</p>
    </div>

  </div>

  <footer class="footer">
    <div class="footer-content">
      <div class="footer-col">
        <h3>Y M Real Estate</h3>
        <p>Your trusted partner in finding the perfect property.</p>
      </div>
      <div class="footer-col">
        <h3>Contact</h3>
        <p>+91 77958 11097</p>
        <p>info@ymrealestate.com</p>
      </div>
      <div class="footer-col">
        <h3>Follow Us</h3>
        <div style="font-size:1.5rem;">
            <a href="#"><i class="fab fa-instagram" style="margin-right:10px; color:#ffd700;"></i></a>
            <a href="#"><i class="fab fa-facebook" style="margin-right:10px; color:#ffd700;"></i></a>
            <a href="#"><i class="fab fa-youtube" style="color:#ffd700;"></i></a>
        </div>
      </div>
    </div>
    <div class="footer-bottom"><p>&copy; 2025 Y M Real Estate</p></div>
  </footer>

  <div id="reelsEditorModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:2000; overflow-y:auto;">
    <div style="max-width:800px; margin:50px auto; background:white; padding:30px; border-radius:15px;">
        <h2 style="text-align:center; margin-bottom:20px;">Edit Social Links</h2>
        <div id="reelsEditorContent"></div>
        <div style="text-align:center; margin-top:20px;">
            <button onclick="saveReels()" style="padding:10px 20px; background:#263f6e; color:white; border:none; border-radius:5px; cursor:pointer;">Save</button>
            <button onclick="closeReelsEditor()" style="padding:10px 20px; background:#ccc; border:none; border-radius:5px; cursor:pointer;">Cancel</button>
        </div>
    </div>
  </div>
  <div class="edit-reels-fab" id="editReelsFab" onclick="openReelsEditor()"><i class="fas fa-edit"></i></div>

  <script>
    // 1. SMART API URL (No duplicate definitions)
    const BASE_URL = window.location.hostname.includes('localhost') ? 'http://localhost:5011/api' : 'https://ym-real-estate.onrender.com/api';
    
    // 2. INIT
    document.addEventListener('DOMContentLoaded', async () => {
        // OAuth
        const p = new URLSearchParams(window.location.search);
        if(p.get('auth')==='success'){
            try {
                const u = JSON.parse(decodeURIComponent(p.get('user')));
                localStorage.setItem('token', u.token); delete u.token;
                localStorage.setItem('user', JSON.stringify(u));
                window.history.replaceState({},'',window.location.pathname);
                window.location.reload();
            } catch(e){}
        }

        // Safe UI load
        if(typeof ui !== 'undefined') ui.updateAuthStatus();
        
        // Load Content (Safe wrapper)
        try { await loadProperties(); } catch(e){}
        try { await loadSocials(); } catch(e){}
        checkAccess();
    });

    // 3. LOADERS
    async function loadProperties() {
        const res = await fetch(`${BASE_URL}/properties`);
        const json = await res.json();
        const data = json.data || json;
        if(Array.isArray(data) && data.length) {
            document.getElementById('featuredProperties').innerHTML = data.slice(0,3).map(p => `
                <div class="property-card" onclick="window.location.href='property-details.html?id=${p._id}'">
                    <img src="${(p.images&&p.images[0]) || 'https://placehold.co/400x300'}" alt="Prop">
                    <div class="property-desc">${p.title}</div>
                    <div style="text-align:center; padding-bottom:15px; color:#666;">₹${Number(p.price).toLocaleString()}</div>
                </div>
            `).join('');
        }
    }

    let currentSocials = { instagram:[], youtube:[], facebook:[] };
    async function loadSocials() {
        const res = await fetch(`${BASE_URL}/socials`);
        const data = await res.json();
        if(data) {
            currentSocials = data;
            renderSocials();
        }
    }

    function renderSocials() {
        renderGrid('instagramGrid', currentSocials.instagram, 'fa-instagram');
        renderGrid('youtubeGrid', currentSocials.youtube, 'fa-youtube');
        renderGrid('facebookGrid', currentSocials.facebook, 'fa-facebook');
    }

    function renderGrid(id, items, icon) {
        const el = document.getElementById(id);
        if(!el) return;
        if(!items || !items.length) { el.innerHTML = '<p style="text-align:center; color:#ccc; width:100%;">Coming soon</p>'; return; }
        el.innerHTML = items.map(i => `
            <a href="${i.url||'#'}" target="_blank" class="insta-card">
                ${i.video ? `<video src="${i.video}" class="insta-card-video" autoplay loop muted></video>` : 
                `<div class="insta-placeholder"><i class="fab ${icon}"></i><p>${i.label}</p></div>`}
            </a>
        `).join('');
    }

    // 4. EDIT LOGIC
    function checkAccess() {
        const u = localStorage.getItem('user');
        if(u) {
            const user = JSON.parse(u);
            if(user.email === 'team@test.com' || user.role === 'admin' || user.role === 'team') {
                document.getElementById('editReelsFab').classList.add('show');
            }
        }
    }

    function openReelsEditor() {
        const c = document.getElementById('reelsEditorContent');
        c.innerHTML = `
            ${makeSec('Instagram', currentSocials.instagram, 'instagram')}
            ${makeSec('YouTube', currentSocials.youtube, 'youtube')}
            ${makeSec('Facebook', currentSocials.facebook, 'facebook')}
        `;
        document.getElementById('reelsEditorModal').style.display = 'block';
    }

    function makeSec(title, items, key) {
        if(!items) items = [];
        let h = `<h3>${title}</h3>`;
        items.forEach((item, i) => {
            h += `<div style="background:#f9f9f9; padding:10px; margin-bottom:10px;">
                <input id="${key}_l_${i}" value="${item.label}" placeholder="Label" style="width:100%; margin-bottom:5px;">
                <input id="${key}_u_${i}" value="${item.url}" placeholder="URL" style="width:100%; margin-bottom:5px;">
                <input type="file" onchange="upVid('${key}', ${i}, event)">
                ${item.video ? '✅ Video' : ''}
                <button onclick="rmItem('${key}', ${i})" style="color:red; margin-left:10px;">Del</button>
            </div>`;
        });
        h += `<button onclick="addItem('${key}')" style="background:#263f6e; color:white; padding:5px;">+ Add</button>`;
        return h;
    }

    function addItem(key) {
        if(!currentSocials[key]) currentSocials[key] = [];
        currentSocials[key].push({label:'New', url:'', video:''});
        openReelsEditor();
    }
    
    function rmItem(key, i) {
        currentSocials[key].splice(i, 1);
        openReelsEditor();
    }

    function upVid(key, i, e) {
        const f = e.target.files[0];
        if(f.size > 5*1024*1024) return alert("Too big");
        const r = new FileReader();
        r.onload = ev => { currentSocials[key][i].video = ev.target.result; openReelsEditor(); };
        r.readAsDataURL(f);
    }

    async function saveReels() {
        const token = localStorage.getItem('token');
        if(!token) return alert("Login first");
        
        ['instagram','youtube','facebook'].forEach(k => {
            if(currentSocials[k]) {
                currentSocials[k].forEach((item, i) => {
                    const l = document.getElementById(`${k}_l_${i}`);
                    const u = document.getElementById(`${k}_u_${i}`);
                    if(l) item.label = l.value;
                    if(u) item.url = u.value;
                });
            }
        });

        try {
            await fetch(`${BASE_URL}/socials`, {
                method: 'POST', headers: {'Content-Type':'application/json', 'Authorization':`Bearer ${token}`},
                body: JSON.stringify(currentSocials)
            });
            alert("Saved!"); closeReelsEditor(); renderSocials();
        } catch(e) { alert("Error"); }
    }

    function closeReelsEditor() { document.getElementById('reelsEditorModal').style.display = 'none'; }
    
    // Global binds
    window.addItem = addItem; window.rmItem = rmItem; window.upVid = upVid;
    window.saveReels = saveReels; window.closeReelsEditor = closeReelsEditor;
  </script>
</body>
</html>
